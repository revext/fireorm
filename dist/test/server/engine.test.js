"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const firebase_admin_1 = __importDefault(require("firebase-admin"));
const src_1 = require("../../src");
const ServerEngine_1 = __importDefault(require("../../src/engine/ServerEngine"));
const models_1 = require("../data/models");
firebase_admin_1.default.initializeApp({
    credential: firebase_admin_1.default.credential.cert(require('../../service-account.json'))
});
(0, src_1.startOrm)(new ServerEngine_1.default(firebase_admin_1.default.app()));
beforeAll(async () => {
    const snapshot = await firebase_admin_1.default.firestore().collection('humans').get();
    snapshot.forEach(async (doc) => {
        await doc.ref.delete();
    });
    await firebase_admin_1.default.firestore().collection('humans').doc('1').set({
        name: 'John'
    });
    await firebase_admin_1.default.firestore().collection('humans').doc('2').set({
        name: 'Jim'
    });
});
test('save on engine, create and save model', async () => {
    const human = new models_1.Human();
    human.name = 'John';
    const savedHuman = await (0, src_1.useEngine)().save(human);
    expect(savedHuman.name).toBe('John');
    expect(savedHuman.createdAt.valueOf()).toBe(human.createdAt.valueOf());
});
test('saveMany on engine, create and save model', async () => {
    const human1 = new models_1.Human();
    human1.name = 'John';
    const human2 = new models_1.Human();
    human2.name = 'Jim';
    const savedHumans = await (0, src_1.useEngine)().saveMany([human1, human2]);
    const docs = [];
    savedHumans.forEach(human => {
        docs.push(firebase_admin_1.default.firestore().collection('humans').doc(human.id));
    });
    const snapshots = await firebase_admin_1.default.firestore().getAll(...docs);
    expect(snapshots[0].data().name).toBe('John');
    expect(snapshots[1].data().name).toBe('Jim');
});
test('update on engine', async () => {
    await (0, src_1.useEngine)().update(src_1.Blueprint.createBlueprint(models_1.Human), "1", { name: "Test" });
    const doc = await firebase_admin_1.default.firestore().collection('humans').doc("1").get();
    expect(doc.data().name).toBe('Test');
});
test('updateMany on engine', async () => {
    const ids = ["1", "2"];
    await (0, src_1.useEngine)().updateMany(src_1.Blueprint.createBlueprint(models_1.Human), ids, { name: "Test" });
    const docs = [];
    ids.forEach(id => {
        docs.push(firebase_admin_1.default.firestore().collection('humans').doc(id));
    });
    const snapshot = await firebase_admin_1.default.firestore().getAll(...docs);
    expect(snapshot[0].data().name).toBe('Test');
    expect(snapshot[1].data().name).toBe('Test');
});
test('load on engine', async () => {
    const loadedHuman = await (0, src_1.useEngine)().load(src_1.Blueprint.createBlueprint(models_1.Human), "1");
    expect(loadedHuman.name).toBe('Test');
});
test('loadMany on engine', async () => {
    const humans = await (0, src_1.useEngine)().loadMany(src_1.Blueprint.createBlueprint(models_1.Human), ["1", "2"]);
    expect(humans[0].name).toBe('Test');
    expect(humans[1].name).toBe('Test');
});
test('loadCollection on engine', async () => {
    const humans = await (0, src_1.useEngine)().loadCollection(src_1.Blueprint.createBlueprint(models_1.Human));
    expect(humans.length).toBe(5);
    expect(humans[0].id).toBe("1");
    expect(humans[1].id).toBe("2");
});
//TODO batch and transaction tests
// test('loadMany by ids on repository', async () => {
//     const humans = await humanRepository.loadMany(["1", "2"])
//     expect(humans.length).toBe(2)
//     expect(humans[0].name).toBe('John')
//     expect(humans[1].name).toBe('Jim')
// })
// test('loadMany on model by repository', async () => {
//     const human = await humanRepository.load("1")
//     await human.load('relatives')
//     human.relatives
//     expect(human.relatives.length).toBe(1)
//     expect(human.relatives[0].name).toBe('Jim')
// })
// test('load by id with additional route params on repository', async () => {
//     const dog = await dogRepository.load("1", { humanId: "1" })
//     expect(dog.name).toBe('Fido')
//     expect(dog.bones[0].length).toBe(10)
//     expect(dog.bones[1].length).toBe(20)
// })
// test('load subcollection on model with repository', async () => {
//     const human = await humanRepository.load("1")
//     await human.load("dogs")
//     expect(human.dogs.length).toBe(1)
//     expect(human.dogs[0].name).toBe("Fido")
// })
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5naW5lLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L3NlcnZlci9lbmdpbmUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLG9FQUFrQztBQUNsQyxtQ0FBMEQ7QUFDMUQsaUZBQXdEO0FBQ3hELDJDQUFzQztBQUV0Qyx3QkFBSyxDQUFDLGFBQWEsQ0FBQztJQUNoQixVQUFVLEVBQUUsd0JBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0NBQzNFLENBQUMsQ0FBQTtBQUNGLElBQUEsY0FBUSxFQUFDLElBQUksc0JBQVksQ0FBQyx3QkFBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUV2QyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDakIsTUFBTSxRQUFRLEdBQUcsTUFBTSx3QkFBSyxDQUFDLFNBQVMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtJQUNuRSxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBQyxHQUFHLEVBQUMsRUFBRTtRQUN6QixNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDMUIsQ0FBQyxDQUFDLENBQUE7SUFFRixNQUFNLHdCQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDdEQsSUFBSSxFQUFFLE1BQU07S0FDZixDQUFDLENBQUE7SUFDRixNQUFNLHdCQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDdEQsSUFBSSxFQUFFLEtBQUs7S0FDZCxDQUFDLENBQUE7QUFDTixDQUFDLENBQUMsQ0FBQztBQUVI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ZWJhc2UtYWRtaW4nXHJcbmltcG9ydCB7IHN0YXJ0T3JtLCB1c2VFbmdpbmUsIEJsdWVwcmludCB9IGZyb20gXCIuLi8uLi9zcmNcIlxyXG5pbXBvcnQgU2VydmVyRW5naW5lIGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvU2VydmVyRW5naW5lJ1xyXG5pbXBvcnQgeyBIdW1hbiB9IGZyb20gJy4uL2RhdGEvbW9kZWxzJ1xyXG5cclxuYWRtaW4uaW5pdGlhbGl6ZUFwcCh7XHJcbiAgICBjcmVkZW50aWFsOiBhZG1pbi5jcmVkZW50aWFsLmNlcnQocmVxdWlyZSgnLi4vLi4vc2VydmljZS1hY2NvdW50Lmpzb24nKSlcclxufSlcclxuc3RhcnRPcm0obmV3IFNlcnZlckVuZ2luZShhZG1pbi5hcHAoKSkpXHJcblxyXG5iZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBhZG1pbi5maXJlc3RvcmUoKS5jb2xsZWN0aW9uKCdodW1hbnMnKS5nZXQoKVxyXG4gICAgc25hcHNob3QuZm9yRWFjaChhc3luYyBkb2MgPT4ge1xyXG4gICAgICAgIGF3YWl0IGRvYy5yZWYuZGVsZXRlKClcclxuICAgIH0pXHJcblxyXG4gICAgYXdhaXQgYWRtaW4uZmlyZXN0b3JlKCkuY29sbGVjdGlvbignaHVtYW5zJykuZG9jKCcxJykuc2V0KHtcclxuICAgICAgICBuYW1lOiAnSm9obidcclxuICAgIH0pXHJcbiAgICBhd2FpdCBhZG1pbi5maXJlc3RvcmUoKS5jb2xsZWN0aW9uKCdodW1hbnMnKS5kb2MoJzInKS5zZXQoe1xyXG4gICAgICAgIG5hbWU6ICdKaW0nXHJcbiAgICB9KVxyXG59KTtcclxuXHJcbnRlc3QoJ3NhdmUgb24gZW5naW5lLCBjcmVhdGUgYW5kIHNhdmUgbW9kZWwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBodW1hbiA9IG5ldyBIdW1hbigpXHJcbiAgICBodW1hbi5uYW1lID0gJ0pvaG4nXHJcbiAgICBjb25zdCBzYXZlZEh1bWFuID0gYXdhaXQgdXNlRW5naW5lKCkuc2F2ZShodW1hbilcclxuXHJcbiAgICBleHBlY3Qoc2F2ZWRIdW1hbi5uYW1lKS50b0JlKCdKb2huJylcclxuICAgIGV4cGVjdChzYXZlZEh1bWFuLmNyZWF0ZWRBdC52YWx1ZU9mKCkpLnRvQmUoaHVtYW4uY3JlYXRlZEF0LnZhbHVlT2YoKSlcclxufSlcclxuXHJcbnRlc3QoJ3NhdmVNYW55IG9uIGVuZ2luZSwgY3JlYXRlIGFuZCBzYXZlIG1vZGVsJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgaHVtYW4xID0gbmV3IEh1bWFuKClcclxuICAgIGh1bWFuMS5uYW1lID0gJ0pvaG4nXHJcbiAgICBjb25zdCBodW1hbjIgPSBuZXcgSHVtYW4oKVxyXG4gICAgaHVtYW4yLm5hbWUgPSAnSmltJ1xyXG4gICAgY29uc3Qgc2F2ZWRIdW1hbnMgPSBhd2FpdCB1c2VFbmdpbmUoKS5zYXZlTWFueShbaHVtYW4xLCBodW1hbjJdKVxyXG5cclxuICAgIGNvbnN0IGRvY3M6IGFueSA9IFtdXHJcbiAgICBzYXZlZEh1bWFucy5mb3JFYWNoKGh1bWFuID0+IHtcclxuICAgICAgICBkb2NzLnB1c2goYWRtaW4uZmlyZXN0b3JlKCkuY29sbGVjdGlvbignaHVtYW5zJykuZG9jKGh1bWFuLmlkKSlcclxuICAgIH0pXHJcblxyXG4gICAgY29uc3Qgc25hcHNob3RzID0gYXdhaXQgYWRtaW4uZmlyZXN0b3JlKCkuZ2V0QWxsKC4uLmRvY3MpXHJcbiAgICBleHBlY3Qoc25hcHNob3RzWzBdLmRhdGEoKS5uYW1lKS50b0JlKCdKb2huJylcclxuICAgIGV4cGVjdChzbmFwc2hvdHNbMV0uZGF0YSgpLm5hbWUpLnRvQmUoJ0ppbScpXHJcblxyXG59KVxyXG5cclxudGVzdCgndXBkYXRlIG9uIGVuZ2luZScsIGFzeW5jICgpID0+IHtcclxuICAgIGF3YWl0IHVzZUVuZ2luZSgpLnVwZGF0ZShCbHVlcHJpbnQuY3JlYXRlQmx1ZXByaW50KEh1bWFuKSwgXCIxXCIsIHsgbmFtZTogXCJUZXN0XCIgfSlcclxuICAgIGNvbnN0IGRvYyA9IGF3YWl0IGFkbWluLmZpcmVzdG9yZSgpLmNvbGxlY3Rpb24oJ2h1bWFucycpLmRvYyhcIjFcIikuZ2V0KClcclxuXHJcbiAgICBleHBlY3QoZG9jLmRhdGEoKS5uYW1lKS50b0JlKCdUZXN0JylcclxufSlcclxuXHJcbnRlc3QoJ3VwZGF0ZU1hbnkgb24gZW5naW5lJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgaWRzID0gW1wiMVwiLCBcIjJcIl1cclxuICAgIGF3YWl0IHVzZUVuZ2luZSgpLnVwZGF0ZU1hbnkoQmx1ZXByaW50LmNyZWF0ZUJsdWVwcmludChIdW1hbiksIGlkcywgeyBuYW1lOiBcIlRlc3RcIiB9KVxyXG5cclxuICAgIGNvbnN0IGRvY3M6IGFueSA9IFtdXHJcbiAgICBpZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgZG9jcy5wdXNoKGFkbWluLmZpcmVzdG9yZSgpLmNvbGxlY3Rpb24oJ2h1bWFucycpLmRvYyhpZCkpXHJcbiAgICB9KVxyXG4gICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBhZG1pbi5maXJlc3RvcmUoKS5nZXRBbGwoLi4uZG9jcylcclxuXHJcbiAgICBleHBlY3Qoc25hcHNob3RbMF0uZGF0YSgpLm5hbWUpLnRvQmUoJ1Rlc3QnKVxyXG4gICAgZXhwZWN0KHNuYXBzaG90WzFdLmRhdGEoKS5uYW1lKS50b0JlKCdUZXN0JylcclxufSlcclxuXHJcblxyXG50ZXN0KCdsb2FkIG9uIGVuZ2luZScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IGxvYWRlZEh1bWFuID0gYXdhaXQgdXNlRW5naW5lKCkubG9hZChCbHVlcHJpbnQuY3JlYXRlQmx1ZXByaW50KEh1bWFuKSwgXCIxXCIpXHJcblxyXG4gICAgZXhwZWN0KGxvYWRlZEh1bWFuLm5hbWUpLnRvQmUoJ1Rlc3QnKVxyXG59KVxyXG5cclxudGVzdCgnbG9hZE1hbnkgb24gZW5naW5lJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgaHVtYW5zID0gYXdhaXQgdXNlRW5naW5lKCkubG9hZE1hbnkoQmx1ZXByaW50LmNyZWF0ZUJsdWVwcmludChIdW1hbiksIFtcIjFcIiwgXCIyXCJdKVxyXG5cclxuICAgIGV4cGVjdChodW1hbnNbMF0ubmFtZSkudG9CZSgnVGVzdCcpXHJcbiAgICBleHBlY3QoaHVtYW5zWzFdLm5hbWUpLnRvQmUoJ1Rlc3QnKVxyXG59KVxyXG5cclxudGVzdCgnbG9hZENvbGxlY3Rpb24gb24gZW5naW5lJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgaHVtYW5zID0gYXdhaXQgdXNlRW5naW5lKCkubG9hZENvbGxlY3Rpb24oQmx1ZXByaW50LmNyZWF0ZUJsdWVwcmludChIdW1hbikpXHJcblxyXG4gICAgZXhwZWN0KGh1bWFucy5sZW5ndGgpLnRvQmUoNSlcclxuICAgIGV4cGVjdChodW1hbnNbMF0uaWQpLnRvQmUoXCIxXCIpXHJcbiAgICBleHBlY3QoaHVtYW5zWzFdLmlkKS50b0JlKFwiMlwiKVxyXG59KVxyXG5cclxuXHJcbi8vVE9ETyBiYXRjaCBhbmQgdHJhbnNhY3Rpb24gdGVzdHNcclxuXHJcblxyXG4vLyB0ZXN0KCdsb2FkTWFueSBieSBpZHMgb24gcmVwb3NpdG9yeScsIGFzeW5jICgpID0+IHtcclxuLy8gICAgIGNvbnN0IGh1bWFucyA9IGF3YWl0IGh1bWFuUmVwb3NpdG9yeS5sb2FkTWFueShbXCIxXCIsIFwiMlwiXSlcclxuXHJcbi8vICAgICBleHBlY3QoaHVtYW5zLmxlbmd0aCkudG9CZSgyKVxyXG4vLyAgICAgZXhwZWN0KGh1bWFuc1swXS5uYW1lKS50b0JlKCdKb2huJylcclxuLy8gICAgIGV4cGVjdChodW1hbnNbMV0ubmFtZSkudG9CZSgnSmltJylcclxuLy8gfSlcclxuXHJcbi8vIHRlc3QoJ2xvYWRNYW55IG9uIG1vZGVsIGJ5IHJlcG9zaXRvcnknLCBhc3luYyAoKSA9PiB7XHJcbi8vICAgICBjb25zdCBodW1hbiA9IGF3YWl0IGh1bWFuUmVwb3NpdG9yeS5sb2FkKFwiMVwiKVxyXG4vLyAgICAgYXdhaXQgaHVtYW4ubG9hZCgncmVsYXRpdmVzJylcclxuLy8gICAgIGh1bWFuLnJlbGF0aXZlc1xyXG5cclxuLy8gICAgIGV4cGVjdChodW1hbi5yZWxhdGl2ZXMubGVuZ3RoKS50b0JlKDEpXHJcbi8vICAgICBleHBlY3QoaHVtYW4ucmVsYXRpdmVzWzBdLm5hbWUpLnRvQmUoJ0ppbScpXHJcbi8vIH0pXHJcblxyXG4vLyB0ZXN0KCdsb2FkIGJ5IGlkIHdpdGggYWRkaXRpb25hbCByb3V0ZSBwYXJhbXMgb24gcmVwb3NpdG9yeScsIGFzeW5jICgpID0+IHtcclxuLy8gICAgIGNvbnN0IGRvZyA9IGF3YWl0IGRvZ1JlcG9zaXRvcnkubG9hZChcIjFcIiwgeyBodW1hbklkOiBcIjFcIiB9KVxyXG5cclxuLy8gICAgIGV4cGVjdChkb2cubmFtZSkudG9CZSgnRmlkbycpXHJcbi8vICAgICBleHBlY3QoZG9nLmJvbmVzWzBdLmxlbmd0aCkudG9CZSgxMClcclxuLy8gICAgIGV4cGVjdChkb2cuYm9uZXNbMV0ubGVuZ3RoKS50b0JlKDIwKVxyXG4vLyB9KVxyXG5cclxuLy8gdGVzdCgnbG9hZCBzdWJjb2xsZWN0aW9uIG9uIG1vZGVsIHdpdGggcmVwb3NpdG9yeScsIGFzeW5jICgpID0+IHtcclxuLy8gICAgIGNvbnN0IGh1bWFuID0gYXdhaXQgaHVtYW5SZXBvc2l0b3J5LmxvYWQoXCIxXCIpXHJcblxyXG4vLyAgICAgYXdhaXQgaHVtYW4ubG9hZChcImRvZ3NcIilcclxuLy8gICAgIGV4cGVjdChodW1hbi5kb2dzLmxlbmd0aCkudG9CZSgxKVxyXG4vLyAgICAgZXhwZWN0KGh1bWFuLmRvZ3NbMF0ubmFtZSkudG9CZShcIkZpZG9cIilcclxuLy8gfSkiXX0=